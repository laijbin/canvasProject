window.onload = function(){
	tankApp();
}	
//是否支持canvas
function canvasSupport() {
    return !!document.createElement('canvas').getContext;
}
function tankApp() {
	var mapLevel = new MapLevel();
	mapLevel.drawMap();
}

//map 
function MapLevel() {
	this.scenenum = [[
		[30,30,30,30,30,30,30,30,30,30,30,30,30,30,30],
		[31, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,31],
		[31, 0, 0, 0,26,26, 0, 0, 0,26,26, 0, 0, 0,31],
		[31, 0, 0,26, 0, 0,26, 0,26, 0, 0,26, 0, 0,31],
		[31, 0, 0,26, 0, 0, 0,26, 0, 0, 0,26, 0, 0,31],
		[31,26, 0, 0,26, 0, 0, 0, 0, 0,26, 0, 0,26,31],
		[31,26, 0, 0, 0,26, 0, 0, 0,26, 0, 0, 0,26,31],
		[31,26, 0, 0, 0, 0,26, 0,26, 0, 0, 0, 0,26,31],
		[31,26,26,26,26, 0, 0,26, 0, 0,26,26,26,26,31],
		[31, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,31],
		[30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]
	],
	[
		[30,30,30,30,30,30,30,30,30,30,30,30,30,30,30],
		[31, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,31],
		[31, 0,26,26,26,26,0, 0,0,26,26, 26,26,0,31],
		[31, 0, 0, 0, 0,26, 0, 0, 0, 26,0, 0, 0, 0,31],
		[31,26,26,26, 26,26,26,26,26,26,26,26, 26,26,31],
		[31, 0, 26, 0, 0, 0, 0,26, 0, 0, 0, 0, 26,0,31],
		[31,26, 26,0,26,26,26,26,26,26,26, 0,26,26,31],
		[31, 0, 0, 0, 0, 26,0, 0, 0,26, 0, 0, 0, 0,31],
		[31,26,26,26,26, 0, 0,0,0,0, 26,26,26,26,31],
		[31, 0, 0,26, 26, 0, 0, 0, 0, 0, 26,26, 0, 0,31],
		[30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]
	],
	[
		[30,30,30,30,30,30,30,30,30,30,30,30,30,30,30],
		[31, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,31],
		[31, 0,26,26,26,26,26, 0,26,26,26,26,26, 0,31],
		[31, 0,26, 0, 0, 0,26, 0,26, 0, 0, 0,26, 0,31],
		[31, 0,26, 0, 0, 0,26, 0,26, 0, 0, 0,26, 0,31],
		[31, 0,26, 0, 0, 0,26, 0,26,26,26,26,26, 0,31],
		[31, 0,26, 0, 0, 0,26, 0, 0, 0, 0, 0,26, 0,31],
		[31, 0,26, 0, 0, 0,26, 0,26, 0, 0, 0,26, 0,31],
		[31, 0,26,26,26,26,26, 0,26,26,26,26,26, 0,31],
		[31, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,31],
		[30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]
	],
	[
		[30,30,30,30,30,30,30,30,30,30,30,30,30,30,30],
		[31, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,31],
		[31, 0,26,26,26,26,26, 0,26,26,26, 0,26,26,31],
		[31, 0, 0, 0, 0,26, 0, 0, 0, 0,26, 0, 0, 0,31],
		[31,26,26,26, 0,26,26,26,26,26,26,26, 0,26,31],
		[31, 0, 0, 0, 0, 0, 0,26, 0, 0, 0, 0, 0,26,31],
		[31,26, 0,26,26,26,26,26,26,26,26, 0,26,26,31],
		[31, 0, 0, 0, 0, 0,26, 0, 0,26, 0, 0, 0, 0,31],
		[31,26,26,26,26, 0, 0,26,26,26, 0,26,26,26,31],
		[31, 0, 0,26, 0, 0, 0, 0, 0, 0, 0,26, 0, 0,31],
		[30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]
	]];
}
MapLevel.prototype ={
	level: 1,//关卡
	drawMap: function() {
		var that = this;
		if (!canvasSupport()) {
			 return;
  		}
		var theCanvas = document.getElementById("canvasOne");
		if(theCanvas == null) return;
		var context = theCanvas.getContext("2d"),
			tankBgimg=new Image(),
			scene = that.scenenum[(that.level-1)];
		tankBgimg.src="tanks_sheet.png";
		//Background
		context.fillStyle = "#CCCCCC";
		context.fillRect(0, 0, theCanvas.width, theCanvas.height);
		//Box
		context.lineWidth=16;
		context.strokeStyle = "#000000"; 
		context.strokeRect(8,8, theCanvas.width-16, theCanvas.height-16);
		// tankBgimg.addEventListener('load', function(){
		// 	for(var i=0;i<=10;i++){
		// 		for(var j=0;j<=14;j++){
		// 			colCtr=j*32+16;
		// 			rowCtr=i*32+16;
		// 			context.save();
		// 			sourceX=Math.floor(scene[i][j]%8)*32;
		// 			sourceY=Math.floor(scene[i][j]/8)*32;
		// 			context.drawImage(tankBgimg, sourceX,sourceY,32,32,colCtr,rowCtr,32,32);
		// 			context.restore();
		// 		}
		// 	}
		// }, false);
		for(var i=0;i<=10;i++){
			for(var j=0;j<=14;j++){
				colCtr=j*32+16;
				rowCtr=i*32+16;
				context.save();
				sourceX=Math.floor(scene[i][j]%8)*32;
				sourceY=Math.floor(scene[i][j]/8)*32;
				context.drawImage(tankBgimg, sourceX,sourceY,32,32,colCtr,rowCtr,32,32);
				context.restore();
			}
		}
		
	}
	
}
